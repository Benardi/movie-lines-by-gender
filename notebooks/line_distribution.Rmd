---
title: "Line distribution on cinema"
output:
  html_document:
    df_print: paged
    toc: yes
    toc_float: yes
  html_notebook:
    toc: yes
    toc_float: yes
---


```{r setup, echo=FALSE, warning=FALSE, message=FALSE}
library(tidyverse)
library(here)
theme_set(theme_bw())
```

```{r, warning=FALSE}
read_csv(here("data/character_list5.csv"),
                      progress = FALSE,
                      col_types = cols(
                                    script_id = col_integer(),
                                    imdb_character_name = col_character(),
                                    words = col_integer(),
                                    gender = col_character(),
                                    age = col_character()
                                    )) %>%
  mutate(age = as.numeric(age)) -> characters_list

characters_list %>% 
  glimpse()

```


```{r}
# read_csv(here("data/character_mapping.csv"),
#                       progress = FALSE,
#                       col_types = cols(
#                                     script_id = col_integer(),
#                                     imdb_id = col_character(),
#                                     character_from_script = col_character(),
#                                     closest_character_name_from_imdb_match = col_character(),
#                                     closest_imdb_character_id = col_character())) ->
#                       characters_mapping
# 
# characters_mapping %>% 
#   glimpse()
```

```{r}
read_csv(here("data/meta_data7.csv"),
                      progress = FALSE,
         col_types = cols(
                        script_id = col_integer(),
                        imdb_id = col_character(),
                        title = col_character(),
                        year = col_integer(),
                        gross = col_integer(),
                        lines_data = col_character()
                        )) -> meta_data

meta_data %>% 
  glimpse()

```

```{r}
left_join(characters_list, 
          meta_data, 
          by=c("script_id")) %>%
  group_by(title, year) %>%
  drop_na(gross) %>%
  mutate(fem_prop = (sum(gender == "f") / n()),
         man_prop = (1 - fem_prop)) %>% 
  ungroup() -> scripts_data

scripts_data %>% 
  glimpse()
```
